#!/bin/bash

if [ -t 2 ] ; then
        RED=$(echo -e '\033[1;31m')
        GREEN=$(echo -e '\033[1;32m')
        NC=$(echo -e '\033[0m')
else
    RED=
    NC=
fi

reformat() {
    sed "s/\\(.*:\\)\\(\\s*-\\?\\)\\(.*\\)/\\1 ${RED}error${NC}: $1\n\\2\\3\n\\2${GREEN}^${NC}/"
}

! (
    grep -Pn '^\t\s*-?(make)\b' $@ | reformat "use \$(MAKE) instead of make for recursive make"
    grep -Pn '^\t\s*-?(rm)\b' $@   | reformat "use \$(RM) instead of rm for deleting files"
) | grep --color=never . 1>&2
